package com.mycompany.cadastrovisitantes;

import com.sun.net.httpserver.HttpServer;
import com.sun.net.httpserver.HttpHandler;
import com.sun.net.httpserver.HttpExchange;

import java.io.IOException;
import java.io.OutputStream;
import java.io.InputStream;
import java.net.InetSocketAddress;
import java.nio.charset.StandardCharsets;
import java.util.Scanner;

public class CadastroVisitantes {

    public static void main(String[] args) throws IOException {
        // Cria um servidor HTTP na porta 8080
        HttpServer server = HttpServer.create(new InetSocketAddress(8080), 0);
        server.createContext("/", new FormHandler());
        server.setExecutor(null); // padrão
        System.out.println("Servidor rodando em http://localhost:8080");
        server.start();
    }

    // Classe interna que trata requisições
    static class FormHandler implements HttpHandler {
        public void handle(HttpExchange exchange) throws IOException {
            String response = "";
            String method = exchange.getRequestMethod();

            if (method.equalsIgnoreCase("GET")) {
                // Exibe o formulário HTML
                response = """
                        <html>
                        <head><title>Cadastro</title></head>
                        <body>
                            <h2>Cadastro de Visitante</h2>
                            <form method="POST">
                                Nome: <input type="text" name="nome"><br><br>
                                Idade: <input type="text" name="idade"><br><br>
                                Motivo da vinda: <input type="text" name="motivo"><br><br>
                                <input type="submit" value="Enviar">
                            </form>
                        </body>
                        </html>
                        """;
            } else if (method.equalsIgnoreCase("POST")) {
                // Lê os dados enviados no formulário
                InputStream inputStream = exchange.getRequestBody();
                Scanner scanner = new Scanner(inputStream, StandardCharsets.UTF_8.name());
                String formData = scanner.useDelimiter("\\A").next();
                scanner.close();

                String[] campos = formData.split("&");
                String nome = campos[0].split("=")[1].replace("+", " ");
                String idade = campos[1].split("=")[1].replace("+", " ");
                String motivo = campos[2].split("=")[1].replace("+", " ");


                   
            }

            // Envia a resposta HTML
            exchange.sendResponseHeaders(200, response.getBytes().length);
            OutputStream os = exchange.getResponseBody();
            os.write(response.getBytes());
            os.close();
        }
    }
}
